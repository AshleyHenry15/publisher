version: '3'

services:
  linux-amd64:
    platform: linux/amd64
    build:
      context: ./docker
      dockerfile: linux.Dockerfile
    volumes: 
      - ../:/publishing-client
    environment:
      BUILD-RUNNER: "linux-amd64"
  
  linux-arm64:
    platform: linux/arm64
    build:
      context: ./docker
      dockerfile: linux.Dockerfile
    volumes: 
      - ../:/publishing-client
    environment:
      BUILD-RUNNER: "linux-arm64"
  
  connect:
    hostname: connect
    image: rstudio/rstudio-connect:jammy
    restart: always
    ports:
      - 3939:3939
    volumes:
      - $PWD/docker/rstudio-connect.gcfg:/etc/rstudio-connect/rstudio-connect.gcfg
    privileged: true
    environment:
      RSTUDIO_CONNECT_HASTE: "enabled"
      RSC_LICENSE: ${CONNECT_LICENSE}
